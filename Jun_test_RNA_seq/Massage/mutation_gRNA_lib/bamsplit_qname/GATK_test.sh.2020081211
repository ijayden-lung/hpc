#PBS -q ser
#PBS -N gatk_10test
#PBS -l nodes=1:ppn=24
#PBS -j oe
#PBS -l walltime=20:00:00
#PBS -V

cd $PBS_O_WORKDIR
############## BWA alignment ############
#bwa mem -t 24 -M -Y -R '@RG\tID:id\tSM:mouse\tLB:Library\tPL:Illumina' ./bwa_index/22genes_transcripts_ref.fasta \
#../S034_sustc-A_MSGMP2_AHYHHHDSXX_S3_L001_R1_001_extracted_val_1.fq.gz \
#../S034_sustc-A_MSGMP2_AHYHHHDSXX_S3_L001_R2_001_extracted_val_2.fq.gz

#bwa mem -t 24 -M -Y -R '@RG\tID:id\tSM:mouse\tLB:Library\tPL:Illumina' ./bwa_index/22genes_transcripts_ref.fasta \
#../S161_sustc-A_MSGMP2N_AHYHJGDSXX_S1_L002_R1_001_extracted_val_1.fq.gz \                                      
#../S161_sustc-A_MSGMP2N_AHYHJGDSXX_S1_L002_R2_001_extracted_val_2.fq.gz

#samtools merge -@ 24 merged.bam S034.bam S161.bam 

#picard BedToIntervalList I=../gRNA_22transcripts_location.bed O=gRNA_22transcripts_location.interval_list \
#SD=../22genes_transcripts_ref.dict



cat barcode_test.csv | while read line
do
    bc='echo $line | awk -F, '{print $2}''
    echo $bc
    #samtools sort -@24 -o $bc_bwa_sorted.bam $bc_bwa.bam
    #samtools index $bc_bwa_sorted.bam

    #picard AddOrReplaceReadGroups I=AAACCTGAGCTGAAAT_bwa_sorted.bam O=AAACCTGAGCTGAAAT_bwa_sorted.Addflag.bam SO=coordinate RGID=id RGLB=library RGPL=Illumina RGPU=machine RGSM=mouse
    #picard -Xmx100g MarkDuplicates I=${id}_sorted.Addflag.bam O=${id}_sorted.Addflag.dedupped.bam CREATE_INDEX=true VALIDATION_STRINGENCY=SILENT M=AAACCTGAGCTGAAAT.metrics

    ## SplitNCigar reads
    #gatk SplitNCigarReads -R ../22genes_transcripts_ref.fasta -I $bc_sorted.Addflag.bam -O $bc_sorted.Addflag.split.bam
    #gatk HaplotypeCaller -R ../22genes_transcripts_ref.fasta -I $bc_bwa_sorted.bam -O $bc_bwa.HC.vcf -L gRNA_22transcripts_location.interval_list
done
