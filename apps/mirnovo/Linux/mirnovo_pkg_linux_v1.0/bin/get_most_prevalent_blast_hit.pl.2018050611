#!/usr/bin/perl

use strict;
use warnings;
use Data::Dumper;

my $input = $ARGV[0];
my $min_aln_id = $ARGV[1];
my $min_aln_length = $ARGV[2];


#trn_t13_i16503_x1	dme-bantam-3p_MIMAT0000365_Drosophila_melanogaster_bantam-3p	100.00	12	0	0	1	12	1	12	0.008	22.9
#trn_t12_i24291_x1	dme-bantam-3p_MIMAT0000365_Drosophila_melanogaster_bantam-3p	100.00	12	0	0	1	12	1	12	0.008	22.9

my %hits = ();

open(FH, $input);

while(my $line = <FH>){

	chomp $line;
#	print "line: $line\n";

	
	my @vals = split("\t", $line);
	my $depth = $vals[0];
	$depth =~ s/.*_x(.*)/$1/;

	my $mir = $vals[1];
	$mir =~ s/_.*//;

	my $aln_id = $vals[2];

	my $aln_length = $vals[3];

#	print "mir: $mir, depth: $depth, aln_id: $aln_id, aln_length: $aln_length\n";

	if($aln_id >= $min_aln_id && $aln_length >= $min_aln_length ){
		if( !defined($hits{ $mir }) ){
			$hits{ $mir } = $depth;
		} else{
			$hits{ $mir } += $depth;
		}
	}

}

my @heights = sort { $hits{$a} <=> $hits{$b} } keys %hits;
my $highest = $heights[-1];

if(defined($highest)){
	print "$highest";
} else{
	print "none";
}

#print Dumper(\%hits);
